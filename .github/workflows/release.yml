name: Release

on:
  release:
    types:
      - published

jobs:
  upload-assets:
    name: Upload assets
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: write
    steps:
      - name: Checkout nijisanji-ime-dic
        uses: actions/checkout@v6

      - name: Checkout userdic-ng
        uses: actions/checkout@v6
        with:
          repository: Umichang/userdic-ng
          path: userdic-ng

      - name: Install userdic-ng
        working-directory: userdic-ng
        run: |
          make
          echo "$PWD" >> $GITHUB_PATH

      - name: Install nkf
        run: |
          sudo apt-get update
          sudo apt-get install -y nkf

      - name: Generate dictionaries
        run: make

      - name: Upload assets
        run: gh release upload "${{ github.ref_name }}" build/*
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
